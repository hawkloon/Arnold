using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading.Tasks;

namespace VoiceRecognition
{
    internal class MalwareAction : Action
    {
        public override string[] Keywords
        {
            get
            {
                return new string[] { "malware", "close window" };
            }
        }

        [DllImport("user32.dll")]
        static extern IntPtr GetForegroundWindow();

        [DllImport("user32.dll")]
        static extern int GetWindowThreadProcessId(IntPtr hWnd, out int lpdwProcessId);


        public void CloseFocusedApp()
        {
            IntPtr hWnd = GetForegroundWindow();
            
            if(hWnd != IntPtr.Zero)
            {
                int processId;
                GetWindowThreadProcessId(hWnd, out processId);
                try
                {
                    var process = System.Diagnostics.Process.GetProcessById(processId);
                    process.Kill();
                }
                catch (Exception ex)
                {
                    Program.synth.SpeakAsync("Failed to close the application: " + ex.Message);
                }
            }
            else
            {
                Program.synth.SpeakAsync("No application is currently focused.");
            }

        }
        public override void OnCalled(string command)
        {
            base.OnCalled(command);
            CloseFocusedApp();

        }
    }
}
